"use strict";(self.webpackChunkcloud_onchain_trade_sdk=self.webpackChunkcloud_onchain_trade_sdk||[]).push([[2572],{82572:(e,t,s)=>{s.r(t),s.d(t,{HistoryDrawer:()=>ce,default:()=>de,openHistoryDrawer:()=>me});var l=s(97458),a=s(78922),r=s(52983),i=s(44478),n=s(90471),o=s(54402),u=s(37404),c=s(72262),m=s(20355),d=s(27618),x=s(64617),h=s(5837),f=s(28216),b=s(25375);const p=({hash:e})=>{const{enableShare:t,useHistoryDetail:s,useColumnMobile:l,useColumnLeverage:a,useColumnSymbol:i,useColumnType:n}=(0,r.useContext)(m.T),{side:o}=l(e),u=a(e),{useHistoryDetailType:c}=s(),{type:f}=c(e),p=n(e),{symbolName:E,symbol:v}=i(e),y="Long"===o,N=t&&1===f,g=(0,r.useCallback)((()=>b.ee.emit("MODAL_POSITION_SHARE_OPEN",{hash:e})),[e]),C=(0,r.useCallback)((()=>b.ee.emit("MODAL_HISTORY_DETAIL_OPEN",{hash:e})),[e]),P="flex h-6 px-2 cursor-pointer justify-center items-center rounded bg-interactive-interactive01 text-caption text-t-third hover:text-t-primary";return(0,r.useMemo)((()=>r.createElement("div",{className:"flex items-center justify-between"},r.createElement("div",{className:"flex items-center gap-1"},r.createElement("div",{className:"text-t-primary text-subtitle2"},E||v),r.createElement("div",{className:`flex items-center justify-center h-4 px-1 rounded ${y?"text-t-buy":"text-t-sell"} ${y?"bg-support-success/30":"bg-support-error/30"} text-subtitle3`},u),r.createElement("div",{className:"flex items-center bg-interactive-interactive01 justify-center h-4 px-1 rounded-[4px] text-t-secondary text-subtitle3"},p)),r.createElement("div",{className:"flex items-center gap-2"},r.createElement("button",{className:(0,d.cn)(P,"px-1"),onClick:C},r.createElement(x.J,{width:"16px",height:"16px",fontSize:"16px"})),N&&r.createElement("button",{className:(0,d.cn)(P,"px-1"),onClick:g},r.createElement(h.f,{width:"16px",height:"16px",fontSize:"16px"}))))),[E,v,y,p,u,C,N,g])},E=({hash:e})=>{const{useColumnPNL:t}=(0,r.useContext)(m.T),{PNL:s,ROI:l,isPNLNegative:a}=t(e),i=(0,r.useMemo)((()=>"-"===s?"--":r.createElement(r.Fragment,null,s,"Â (",l,")")),[s,l]);return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-left items-start"},r.createElement("div",{className:"text-subtitle3"},r.createElement("div",{className:"text-subtitle3 whitespace-nowrap",style:{color:void 0===a?"rgb(var(--colors-t-secondary))":a?"rgb(var(--colors-t-sell))":"rgb(var(--colors-t-buy))"}},i)),r.createElement("div",{className:"text-t-third text-caption1"},"PNL"))),[a,i])},v=({hash:e})=>{const{getI18n:t,useColumnInitialCollateral:s}=(0,r.useContext)(m.T),l=s(e);return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-right items-end"},r.createElement("div",{className:"text-t-primary text-subtitle3"},l),r.createElement("div",{className:"text-t-third text-caption1"},t("userinfo-positions-column-initialAmount",{defaultValue:"Initial Amount"})))),[t,l])},y=({hash:e})=>{const{getI18n:t,useColumnMobile:s}=(0,r.useContext)(m.T),{size:l}=s(e);return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-left items-start flex-[1]"},r.createElement("div",{className:"text-t-primary text-subtitle3"},l),r.createElement("div",{className:"text-t-third text-caption1"},t("userinfo-history-mobile-size",{defaultValue:"Size(USD)"})))),[t,l])},N=({hash:e})=>{const{getI18n:t,useColumnMobile:s}=(0,r.useContext)(m.T),{price:l}=s(e);return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-center items-center flex-[1]"},r.createElement("div",{className:"text-t-primary text-subtitle3"},l),r.createElement("div",{className:"text-t-third text-caption1"},t("userinfo-history-column-closePrice",{defaultValue:"Close Price"})))),[t,l])},g=({hash:e})=>{const{getI18n:t,useColumnFee:s}=(0,r.useContext)(m.T),l=s(e);return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-right items-end flex-[1]"},r.createElement("div",{className:"text-t-primary text-subtitle3"},l),r.createElement("div",{className:"text-t-third text-caption1"},t("userinfo-history-mobile-fee",{defaultValue:"Fee"})))),[t,l])},C=({hash:e})=>{const{getI18n:t,useColumnTime:s}=(0,r.useContext)(m.T),l=s(e);return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-left items-start"},r.createElement("div",{className:"text-t-primary text-subtitle3"},l),r.createElement("div",{className:"text-t-third text-caption1"},t("userinfo-history-mobile-time",{defaultValue:"Time"})))),[t,l])},P=({hash:e})=>{const{getI18n:t,useClassicPerp:s}=(0,r.useContext)(m.T),{chain:l}=(0,f.m)(),{useClassicDataByFiled:a}=s(),i=a(e,"txHash");return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-right items-end"},r.createElement("a",{target:"_blank",rel:"noreferrer",href:`${l?.blockExplorers?.default.url.replace(/\/$/,"")}/tx/${i}`,className:"text-subtitle3 text-t-link cursor-pointer"},`${i}`.slice(0,11),"..."),r.createElement("div",{className:"text-t-third text-caption1"},t("userinfo-history-column-hash","Transaction Hash")))),[l?.blockExplorers?.default.url,t,i])},M=({hash:e})=>(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col mt-2 w-full"},r.createElement("div",{className:"flex flex-row justify-between mt-2"},r.createElement(E,{hash:e}),r.createElement(v,{hash:e})),r.createElement("div",{className:"flex flex-row mt-2"},r.createElement(y,{hash:e}),r.createElement(N,{hash:e}),r.createElement(g,{hash:e})),r.createElement("div",{className:"flex flex-row justify-between mt-2"},r.createElement(C,{hash:e}),r.createElement(P,{hash:e})))),[e]),T=({hash:e})=>(0,r.useMemo)((()=>r.createElement("div",{className:"positions-column-mobile box-border p-4 border-b-border-line border-b border-solid","data-column-hash":e},r.createElement(p,{hash:e}),r.createElement(M,{hash:e}))),[e]),D=()=>{const{useHistory:e,useHistoryInitialed:t,getI18n:s,useHistoryLoadMore:l,useTheme:a}=(0,r.useContext)(m.T),{isLight:i}=a(),n=(0,r.useRef)(null),d=(0,u.Z)(n,{root:null,rootMargin:"20px",threshold:1}),x=e(),h=t(),{loadMoreLoading:f,hasMore:b,loadMore:p}=l(),E=(0,r.useMemo)((()=>!!d?.isIntersecting),[d?.isIntersecting]);return(0,r.useEffect)((()=>{b&&!f&&E&&p?.()}),[b,E,p,f]),(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col w-full h-full min-h-10"},x.length?x.map((e=>r.createElement(T,{key:`_h_classic_m_${e}`,hash:e}))):h?r.createElement(c.$,{isLight:i,title:s("userinfo-history-no-data",{defaultValue:"No History Data"})}):null,r.createElement("div",{ref:n}),f&&r.createElement(o.g,{fullScreen:!0,inner:!0}))),[s,x,h,i,f])};var I=s(26583),w=s(99297),H=s(89663),S=s(95386),L=s(42249);const k=({hash:e})=>{const{getI18n:t,useDumbPrediction:s}=(0,r.useContext)(m.T),{usePredictionDataByFiled:l}=s(),a=l(e,"startTime");return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-center items-center flex-1"},r.createElement("div",{className:"text-t-primary text-subtitle3"},(0,w.v)(new Date(1e3*a),"MM-dd hh:mm:ss")),r.createElement("div",{className:"text-t-third text-caption1 mt-0.5"},t("userinfo-positions-column-entryTime",{defaultValue:"Entry Time"})))),[t,a])},_=({hash:e})=>{const{getI18n:t,useDumbPrediction:s}=(0,r.useContext)(m.T),{usePredictionDataByFiled:l,usePricePrecision:a}=s(),i=l(e,"symbol"),n=l(e,"entryPrice"),o=a(i);return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-center items-center flex-1"},r.createElement("div",{className:"text-t-primary text-subtitle3"}," ",(0,H.uf)(n,o)),r.createElement("div",{className:"text-t-third text-caption1 mt-0.5"},t("userinfo-positions-column-entryPrice",{defaultValue:"Entry Price"})))),[n,t,o])},j=({hash:e})=>{const t=(0,L.h)(),{getI18n:s,useDumbPrediction:l}=(0,r.useContext)(m.T),{usePredictionDataByFiled:a}=l(),i=a(e,"principal"),n=a(e,"tokenIn"),o=t[n]||n;return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-left items-start flex-1"},r.createElement("div",{className:"text-t-primary text-subtitle3"}," ",`${i} ${o}`),r.createElement("div",{className:"text-t-third text-caption1 mt-0.5"},s("userinfo-positions-column-initialAmount",{defaultValue:"Initial Amount"})))),[s,i,o])},F=({hash:e})=>{const{getI18n:t,useDumbPrediction:s}=(0,r.useContext)(m.T),{usePredictionDataByFiled:l}=s(),a=l(e,"executionTime");return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-right items-end flex-1"},r.createElement("div",{className:"text-t-primary text-subtitle3"},(0,w.v)(new Date(1e3*a),"MM-dd hh:mm:ss")),r.createElement("div",{className:"text-t-third text-caption1 mt-0.5"},t("userinfo-positions-column-expireTime",{defaultValue:"Expire Time"})))),[a,t])},V=({hash:e})=>{const{getI18n:t,useDumbPrediction:s}=(0,r.useContext)(m.T),{usePredictionDataByFiled:l,usePricePrecision:a}=s(),i=l(e,"symbol"),n=l(e,"executionPrice"),o=a(i);return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-right items-end flex-1"},r.createElement("div",{className:"text-t-primary text-subtitle3"},(0,H.uf)(n,o)),r.createElement("div",{className:"text-t-third text-caption1 mt-0.5"},t("userinfo-positions-column-expirePrice",{defaultValue:"Expire Price"})))),[n,t,o])},$=({hash:e})=>{const t=(0,L.h)(),{useDumbPrediction:s}=(0,r.useContext)(m.T),{usePredictionDataByFiled:l,useAssetPrecision:a,useCurrentPrice:i,predictionPairs:n}=s(),o=l(e,"tokenIn"),u=t[o]||o,c=l(e,"symbol"),d=a(u),x=i(e),h=l(e,"executionPrice"),f=l(e,"entryPrice")||0,b=l(e,"principal")||0,p=l(e,"pnl")||0,E=l(e,"isLong"),v=l(e,"openFee")||0,y=l(e,"closeFee")||0,N=l(e,"state")||0,g=l(e,"executionTime")||0,C=l(e,"startTime")||0,P=Number(g)-Number(C),M=S.Z1.get(P),T=(0,r.useMemo)((()=>n?.find((e=>c===e.name?.replace("/","")))?.predictionPeriods.find((e=>e.period===M))),[M,n,c]),D=Number(b)-Number(v),I=T&&void 0!==T.winRatio&&void 0!==T.winCloseFeeP?(T.winRatio-T.winCloseFeeP)/10**S.cB.percent:0,w=0===N||1===N?Number(x):h,k=E?Number(w)>Number(f):Number(w)<Number(f),_=k?0===N?I:(Number(p)-Number(y))/Number(b):-1,j=k?0===N?D*_:Number(p)-Number(y):Number(b)*_,F=`${(0,H.uf)(100*_,2)}%`,V=(0,H.uf)(j,d);return(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-left items-start flex-1"},r.createElement("div",{className:"text-subtitle3"},r.createElement("div",{className:"text-subtitle3 whitespace-nowrap",style:{color:void 0===j?"rgb(var(--colors-t-secondary))":j<0?"rgb(var(--colors-t-sell))":"rgb(var(--colors-t-buy))"}},V,"Â (",F,")")),r.createElement("div",{className:"text-t-third text-caption1 mt-0.5"},"PNL"))),[j,V,F])},O=e=>{const t=Math.floor((new Date).getTime()/1e3);return Math.max(e-t,-1)},B=({hash:e})=>{const{getI18n:t,useDumbPrediction:s}=(0,r.useContext)(m.T),{usePredictionDataByFiled:l}=s(),a=l(e,"state"),i=l(e,"startTime"),n=l(e,"executionTime"),o=n-i,u=(0,r.useRef)(null),[c,d]=(0,r.useState)(O(n)),x=window.getComputedStyle(document.documentElement),h=`rgb(${x.getPropertyValue("--colors-border-line")})`,f=`rgb(${x.getPropertyValue("--colors-highLight")})`;return(0,r.useEffect)((()=>{u.current&&clearInterval(u.current),d(O(n));const e=()=>{u.current&&(clearInterval(u.current),u.current=null)};return u.current=setInterval((()=>d((t=>{const s=t-1;if(s>-1)return s;const l=O(n);return l>-1?l:(e(),-1)}))),1e3),e}),[n]),(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col text-right items-end flex-1"},r.createElement("div",{className:(1===a?"text-t-emphasize":"text-t-primary")+"  text-subtitle3"},0===a&&r.createElement(r.Fragment,null,c>-1?r.createElement("div",{className:"flex flex-row items-center"},r.createElement("div",{className:"text-highLight mr-1.5"},c,"s"),r.createElement(I.m,{id:`canvas-${e}`,percent:c>o?100:(o-c)/o*100,size:16,width:1.6,color:f,bgColor:h})):t("userinfo-history-column-status-in-progress","Statement in progress")),1===a&&t("userinfo-history-column-status-in-progress","Statement in progress"),2===a&&t("userinfo-history-column-status-finish","Finish")))),[c,o,t,e,f,h,a])},R=({hash:e})=>{const{getI18n:t,useDumbPrediction:s}=(0,r.useContext)(m.T),{usePredictionDataByFiled:l}=s(),a=l(e,"symbol"),i=l(e,"isLong");return(0,r.useMemo)((()=>r.createElement("div",{className:"flex items-start justify-between"},r.createElement("div",{className:"flex items-center gap-1"},r.createElement("div",{className:"text-t-primary text-subtitle2"},a),r.createElement("div",{className:`flex items-center justify-center h-4 px-1 rounded ${i?"text-t-buy":"text-t-sell"} ${i?"bg-support-success/30":"bg-support-error/30"} text-subtitle3`},i?t("userinfo-positions-long","Long"):t("userinfo-positions-short","Short"))),r.createElement(B,{hash:e}))),[a,i,t,e])},A=({hash:e})=>(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col w-full"},r.createElement("div",{className:"flex flex-row justify-between mt-3"},r.createElement($,{hash:e}),r.createElement(k,{hash:e}),r.createElement(F,{hash:e})),r.createElement("div",{className:"flex flex-row mt-2"},r.createElement(j,{hash:e}),r.createElement(_,{hash:e}),r.createElement(V,{hash:e})))),[e]),z=({hash:e})=>(0,r.useMemo)((()=>r.createElement("div",{className:"positions-column-mobile box-border p-4 border-b-border-line border-b border-solid","data-column-hash":e},r.createElement(R,{hash:e}),r.createElement(A,{hash:e}))),[e]),U=()=>{const{useDumbPrediction:e,getI18n:t,useTheme:s}=(0,r.useContext)(m.T),{fetchPredictions:l,usePredictions:a,usePredictionInitialed:i,usePredictionHasMore:n,usePredictionLoading:d}=e(),{isLight:x}=s(),h=(0,r.useRef)(null),f=(0,u.Z)(h,{root:null,rootMargin:"20px",threshold:1}),b=i(),p=a(),E=d(),v=n(),y=(0,r.useMemo)((()=>!!f?.isIntersecting),[f?.isIntersecting]);return(0,r.useEffect)((()=>{v&&!E&&y&&l?.()}),[l,v,y,E]),(0,r.useMemo)((()=>r.createElement("div",{className:"flex flex-col w-full h-full"},p.length?p.map((e=>r.createElement(z,{key:`_h_dumb_m_${e}`,hash:e}))):b?r.createElement(c.$,{isLight:x,title:t("userinfo-history-no-data",{defaultValue:"No History Data"})}):null,r.createElement("div",{ref:h}),E&&r.createElement(o.g,{fullScreen:!0,inner:!0}))),[t,b,x,E,p])};var W=s(69464),Z=s(2203),Y=s(19844);const G="h-6 py-0 rounded px-2 text-subtitle2 text-t-third data-[state=active]:bg-interactive-primary data-[state=active]:text-t-white",K=()=>{const{enableDumb:e,getI18n:t}=(0,r.useContext)(m.T),{tradeModeTab:s,changeTradeModeTab:l}=(0,n.G)();return(0,r.useMemo)((()=>r.createElement(a.mQ,{className:"relative w-full h-full",value:s,onValueChange:l},r.createElement("div",{className:"relative w-full h-full flex flex-col history-container-mobile"},e?r.createElement("div",{className:"flex justify-between items-center px-4 mt-4"},r.createElement(a.dr,{className:"p-0 bg-background-bg1Accent01 h-6 rounded"},r.createElement(a.SP,{className:G,value:i.O.Classic},t("userinfo-positions-tab-perp","Perp")),r.createElement(a.SP,{className:G,value:i.O.Dumb},t("userinfo-positions-tab-dumb","Dumb")))):r.createElement("div",null),r.createElement(a.nU,{className:"hidden flex-col w-full h-full data-[state=active]:flex mt-0",value:i.O.Classic},r.createElement(D,null)),r.createElement(a.nU,{className:"hidden flex-col w-full h-full data-[state=active]:flex mt-0",value:i.O.Dumb},r.createElement(U,null))))),[e,t,s,l])},q=e=>(0,r.useMemo)((()=>r.createElement(m.T.Provider,{value:{locale:e.locale,staticHost:e.staticHost,siteHost:e.staticHost,enableShare:e.enableShare,enableShareLink:e.enableShareLink,enableDumb:e.enableDumb,getI18n:e.getI18n,useTheme:e.useTheme,useHistoryLoadMore:e.useHistoryLoadMore,useHistory:e.useHistory,useHistoryInitialed:e.useHistoryInitialed,useColumnFee:e.useColumnFee,useColumnMobile:e.useColumnMobile,useColumnLeverage:e.useColumnLeverage,useColumnPNL:e.useColumnPNL,useColumnPrice:e.useColumnPrice,useColumnSymbol:e.useColumnSymbol,useColumnTime:e.useColumnTime,useColumnType:e.useColumnType,useColumnSide:e.useColumnSide,useColumnSize:e.useColumnSize,useHistoryDetail:e.useHistoryDetail,useSymbolLogo:e.useSymbolLogo,useClassicPerp:e.useClassicPerp,useColumnInitialCollateral:e.useColumnInitialCollateral,useDumbPrediction:e.useDumbPrediction?e.useDumbPrediction:()=>({fetchPredictions:()=>{},useHistoryTab:()=>["",()=>{}],usePredictionDataByFiled:()=>{},usePredictionHasMore:()=>!1,usePredictionInitialed:()=>!1,usePredictionLoading:()=>!1,usePredictions:()=>[],usePricePrecision:()=>2,useAssetPrecision:()=>2,useCurrentPrice:()=>"-",predictionPairs:[]})}},r.createElement(K,null),r.createElement(W.C.Provider,{value:{locale:e.locale,staticHost:e.staticHost,siteHost:e.siteHost,enableShare:e.enableShare,enableShareLink:e.enableShareLink,getI18n:e.getI18n,useTheme:e.useTheme,useHistoryDetail:e.useHistoryDetail,ee:b.ee}},r.createElement(Z.F,null),r.createElement(Y.m,null)))),[e]);var J=s(33740),Q=s(58395),X=s(43693),ee=s(33687),te=s(87685),se=s(2547),le=s(96988),ae=s(68692),re=s(52590),ie=s(1619),ne=s(10978);const oe=()=>{const{loadMoreLoading:e,hasMore:t,loadMore:s}=(0,ne.xK)(),{getI18n:a,i18n:{language:i}}=(0,le.V6)();(0,ne.oU)();const n=(0,ae.h)(),o=(0,r.useCallback)((()=>({loadMore:s,hasMore:t,loadMoreLoading:e})),[t,s,e]),{dumb:u}=(0,se.B)();return(0,r.useMemo)((()=>(0,l.jsx)(q,{locale:i,siteHost:ee.brokerConfig.staticBaseUrl,staticHost:ee.brokerConfig.apxStaticBaseUrl,getI18n:a,Link:X.G,useTheme:re.F,useHistory:ne.k6,useHistoryInitialed:ne.zV,useColumnSymbol:ne.iA,useColumnLeverage:ne.ch,useColumnTime:ne.a6,useColumnFee:ne.b2,useColumnType:ne.r2,useColumnPrice:ne.yT,useColumnPNL:ne.RM,useHistoryLoadMore:o,useColumnMobile:ne.Xi,useColumnSide:ne.uq,useColumnSize:ne.v_,useHistoryDetail:ne.uN,useDumbPrediction:ne.D,useClassicPerp:ne.ZK,enableShare:!0,enableShareLink:n,enableDumb:u,useSymbolLogo:te.sH,useColumnInitialCollateral:ne.d3})),[i,a,o,n,u])},ue=()=>{const{getI18n:e}=(0,le.V6)();return(0,r.useMemo)((()=>(0,l.jsx)("div",{className:"text-body1 text-t-third",children:e("userinfo-history-no-data",{defaultValue:"No History Data"})})),[e])},ce=()=>{const[e,t]=(0,r.useState)(0),{getI18n:s}=(0,le.V6)(),{isConnected:a}=(0,f.m)();(0,r.useEffect)((()=>ie.ee.on("SHOW_HISTORY_DRAWER",(()=>{t(Date.now())}))),[]);const i=(0,r.useCallback)((()=>{t(0)}),[]);return(0,r.useMemo)((()=>(0,l.jsx)(J.yo,{open:Boolean(e),children:(0,l.jsx)(J.ue,{side:"bottom",className:"w-full outline-none border-none px-4 py-0 rounded-t-[4px] bg-[#121221] z-dialog",onPointerDownOutside:i,children:e?a?(0,l.jsxs)("div",{className:"h-[445px]",children:[(0,l.jsxs)("div",{className:"h-[54px] flex items-center justify-center",children:[(0,l.jsx)("div",{className:"text-t-primary pl-4 text-subtitle4",children:s("userinfo-history-module-titleV2",{defaultValue:"History"})}),(0,l.jsx)(Q.E,{width:"20px",height:"20px",fontSize:"20px",className:"cursor-pointer absolute right-4 text-t-third",onClick:i})]}),(0,l.jsx)("div",{className:"w-full h-[calc(100%-54px)] overflow-auto",children:(0,l.jsx)(oe,{})})]},e):(0,l.jsx)("div",{className:"w-full h-[calc(100%-54px)] overflow-auto flex items-center justify-center",children:(0,l.jsx)(ue,{})}):null})})),[s,a,e,i])},me=()=>ie.ee.emit("SHOW_HISTORY_DRAWER",void 0),de=oe},1619:(e,t,s)=>{s.d(t,{ee:()=>l});const l=new(s(58407).v)}}]);